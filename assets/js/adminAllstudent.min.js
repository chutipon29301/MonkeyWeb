let generateTable=(()=>{var a=_asyncToGenerator(function*(){sessionStorage.setItem("status",$("#status-select").val()),sessionStorage.setItem("state",$("#state-select").val()),sessionStorage.setItem("grade",$("#grade-select").val()),sessionStorage.setItem("course",$("#course-select").val());let b={quarter:$("#quarter-select").val(),status:$("#status-select").val(),state:$("#state-select").val(),grade:$("#grade-select").val(),course:$("#course-select").val()};try{let c=yield $.get("/adminAllstudentTable",b);$("#content-panel").empty(),$("#content-panel").append(c),$("#std-count").html($(".std-row").length)}catch(c){$("#content-panel").empty(),$("#content-panel").append("<h1>Error to get data from server.</h1>"),$("#std-count").html("--")}});return function(){return a.apply(this,arguments)}})(),getSearchData=(()=>{var a=_asyncToGenerator(function*(){let b=(yield $.post("post/v1/allStudent")).users,c=b.map(function(d){return{name:d.nickname+" "+d.firstname,id:d.studentID}});$("#search-input").typeahead({source:c,autoSelect:!0}),$("#search-input").focus()});return function(){return a.apply(this,arguments)}})(),showRating=(()=>{var a=_asyncToGenerator(function*(b){let c=(yield $.post("v2/rating/list",{studentID:b})).rating;for(let d in c)switch(c[d].type){case"study":$("#dialog-std-star").html(drawStar(c[d].rating)),$("#dialog-std-score").html(c[d].rating);break;case"behavior":$("#dialog-bv-star").html(drawStar(c[d].rating)),$("#dialog-bv-score").html(c[d].rating);break;default:}$("#ratingHeader").html(b),$("#dialog-more-rating").collapse("hide"),$("#dialog-go-btn").hide(),$("#dialog-sm-btn").html("More"),$("#ratingDialog").modal("show")});return function(){return a.apply(this,arguments)}})(),showMoreRating=(()=>{var a=_asyncToGenerator(function*(){let b=+$("#ratingHeader").html(),c=(yield $.post("v2/rating/listDetail",{studentID:b})).rating.map(function(d){return{courseID:d.rating.courseID,type:d.rating.type,tutorID:d.rating.tutorID,score:d.rating.score}});for(let d in $("#dialog-more-bv-rating").empty(),$("#dialog-more-std-rating").empty(),c=_.groupBy(c,"type"),c.behavior=_.groupBy(c.behavior,"tutorID"),c.study=_.groupBy(c.study,"tutorID"),c.behavior){let f=c.behavior[d].length,g=_.sumBy(c.behavior[d],function(j){return j.score});$("#dialog-more-bv-rating").append("<label>"+d+": </label><label style=\"color:#FBC02D\">"+drawStar(g/f)+"</label>")}for(let d in c.study){let f=c.study[d].length,g=_.sumBy(c.study[d],function(j){return j.score});$("#dialog-more-std-rating").append("<label>"+d+": </label><label style=\"color:#FBC02D\">"+drawStar(g/f)+"</label>")}$("#dialog-more-rating").collapse("show")});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function f(g,h){try{var j=b[g](h),k=j.value}catch(l){return void d(l)}return j.done?void c(k):Promise.resolve(k).then(function(l){f("next",l)},function(l){f("throw",l)})}return f("next")})}}const checkType=()=>{767<$(document).width()?$("#filter-panel").addClass("position-fixed"):$("#filter-panel").removeClass("position-fixed")};checkType(),$(window).resize(()=>{checkType()});let cookies=getCookieDict(),pos;position(cookies.monkeyWebUser).then(a=>{pos=a.position}),cookies.monkeyWebSelectedQuarter&&$("#quarter-select").val(cookies.monkeyWebSelectedQuarter),0<sessionStorage.length&&($("#status-select").val(sessionStorage.status),$("#state-select").val(sessionStorage.state),$("#grade-select").val(sessionStorage.grade),$("#course-select").val(sessionStorage.course)),generateTable(),$(".filter").change(function(){generateTable()}),$("#quarter-select").change(function(){writeCookie("monkeyWebSelectedQuarter",this.value),generateTable()});const goToStudentProfile=a=>{"tutor"!=pos&&(writeCookie("monkeyWebAdminAllstudentSelectedUser",a),self.location="/adminStudentprofile")};$("#barcode-form").submit(function(a){a.preventDefault(),goToStudentProfile($("#barcode-input").val().slice(0,-1))}),getSearchData(),$("#search-input").change(function(){let a=$("#search-input").typeahead("getActive");goToStudentProfile(a.id)});function createNewStudent(){$.post("/post/addBlankStudent",{number:1}).then(a=>{$("#newStudentUsername").html("Username: "+a.student[0].studentID),$("#newStudentPassword").html("Password: "+a.student[0].password),$("#newStudentDialog").modal({backdrop:"static",keyboard:!1})})}function closeNewStudentDialog(){$("#newStudentDialog").modal("hide"),location.reload()}const drawStar=a=>{let b="";for(let c=1;6>c;c++)c<a?b+="<span class=\"fas fa-star\"></span>":0.5>=c-a&&(b+="<span class=\"fas fa-star-half\"></span>");return b};$("#dialog-go-btn").hide(),$("#dialog-sm-btn").click(function(){"More"==this.innerHTML?(showMoreRating(),$("#dialog-go-btn").show(),$("#dialog-sm-btn").html("Less")):($("#dialog-more-rating").collapse("hide"),$("#dialog-go-btn").hide(),$("#dialog-sm-btn").html("More"))});function clearRemark(){"tutor"!=pos&&confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E04\u0E25\u0E35\u0E22\u0E23\u0E4C\u0E17\u0E31\u0E49\u0E07\u0E2B\u0E21\u0E14?")&&$.post("post/v1/resetRemark").then(()=>{location.reload()})}function changeRemark(a,b){"tutor"!=pos&&$.post("post/v1/setRemark",{studentID:a,remark:b}).then(()=>{let c,d,f;switch(b){case"1":c="fa-check-circle",d="blue",f=2;break;case"2":c="fa-check-circle",d="green",f=0;break;case"3":c="fa-times-circle",d="orange",f=1;break;default:c="fa-times-circle",d="red",f=3;}$("#remark"+a).html("<span class=\"far fa-2x "+c+"\" style=\"color:"+d+"\" onclick=\"changeRemark('"+a+"','"+f+"')\"></span>")})}