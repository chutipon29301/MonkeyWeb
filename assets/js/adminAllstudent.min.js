let generateStudentHtmlTable=(()=>{var a=_asyncToGenerator(function*(b){let c=document.getElementById("allStudentTable");c.innerHTML="",$("#stdCount").html(b.length);for(let d=0;d<b.length;d++){let e=c.insertRow(d),f=b[d].status,g=b[d].registrationState;"terminated"===f?e.setAttribute("class","table-danger"):"dropped"===f?e.setAttribute("class","table-warning"):"inactive"===f?e.setAttribute("class","table-info"):void 0;"finished"===g&&e.setAttribute("class","table-success");let h="",j="";b[d].remark===void 0?j="<span class='far fa-2x fa-times-circle' style='color:red'></span>":(h=b[d].remark,j="1"==h?"<span class='far fa-2x fa-check-circle' style='color:blue'></span>":"2"==h?"<span class='far fa-2x fa-check-circle' style='color:green'></span>":"3"==h?"<span class='far fa-2x fa-times-circle' style='color:orange'></span>":"<span class='far fa-2x fa-times-circle' style='color:red'></span>");let k="No rating";if(b[d].rating!==void 0){let x=parseInt(b[d].rating),y=6-parseInt(5-b[d].rating);k="";for(let z=1;5>=z;z++)z<=x?k+="<span class=\"fas fa-star\" style=\"color:#FBC02D\"></span>":z<y&&(k+="<span class=\"fas fa-star-half\" style=\"color:#FBC02D\"></span>")}let l=e.insertCell(0),m=e.insertCell(1),n=e.insertCell(2),o=e.insertCell(3),p=e.insertCell(4),q=e.insertCell(5),r=e.insertCell(6),s=e.insertCell(7);l.innerHTML="<td>"+b[d].studentID+"</td>",m.innerHTML="<td>"+k+"</td>",n.innerHTML="<td>"+getLetterGrade(b[d].grade)+"</td>",o.innerHTML="<td>"+b[d].nickname+"</td>",p.innerHTML="<td>"+b[d].firstname+"</td>",q.innerHTML="<td>"+b[d].level+"</td>";let t="";0<b[d].chats.length&&(t=b[d].chats[0].sender[0].nicknameEn+"-"+b[d].chats[0].msg),r.innerHTML="<td>"+t+"</td>",s.innerHTML="<td>"+j+"</td>",s.id=h;let u=function(x){return function(){writeCookie("monkeyWebAdminAllstudentSelectedUser",x.getElementsByTagName("td")[0].innerHTML),self.location="/adminStudentprofile"}};l.onclick=u(e),n.onclick=u(e),o.onclick=u(e),p.onclick=u(e),q.onclick=u(e),r.onclick=u(e);s.onclick=function(x,y){return function(){let z="";""===y.id||"0"===y.id?z="3":"3"===y.id?z="1":"1"===y.id?z="2":"2"===y.id&&(z="0"),$.post("post/v1/setRemark",{studentID:x.getElementsByTagName("td")[0].innerHTML,remark:z}).then(function(){let A="";""===y.id||"0"===y.id?(A="<span class='far fa-2x fa-times-circle' style='color:orange'></span>",y.id="3"):"1"===y.id?(A="<span class='far fa-2x fa-check-circle' style='color:green'></span>",y.id="2"):"2"===y.id?(A="<span class='far fa-2x fa-times-circle' style='color:red'></span>",y.id="0"):"3"===y.id&&(A="<span class='far fa-2x fa-check-circle' style='color:blue'></span>",y.id="1"),y.innerHTML="<td>"+A+"</td>"})}}(e,s);m.onclick=function(x){return function(){$.post("v2/rating/list",{studentID:x.getElementsByTagName("td")[0].innerHTML}).then(function(y){if(console.log(y.rating),0<y.rating.length){for(let z in y.rating){let A=parseInt(y.rating[z].rating),B=6-parseInt(5-y.rating[z].rating),C="";for(let D=1;5>=D;D++)D<=A?C+="<span class=\"fas fa-star\" style=\"color:#FBC02D\"></span>":D<B&&(C+="<span class=\"fas fa-star-half\" style=\"color:#FBC02D\"></span>");switch(y.rating[z].type){case"study":$("#modal-std-score").html(y.rating[z].rating),$("#modal-std-star").html(C);break;case"behavior":$("#modal-bv-score").html(y.rating[z].rating),$("#modal-bv-star").html(C);break;default:}}$("#ratingDialog").modal()}})}}(e)}});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var h=b[f](g),j=h.value}catch(k){return void d(k)}return h.done?void c(j):Promise.resolve(j).then(function(k){e("next",k)},function(k){e("throw",k)})}return e("next")})}}let studentForSearch=[];const getLetterGrade=a=>{return 6>=a?"P"+a:"S"+(a-6)},getDateName=a=>{return["SUN","MON","TUE","WED","THU","FRI","SAT"][a]};$(function(){log($(document).width()),767<$(document).width()&&$("#filterPanel").addClass("position-fixed"),getAllStudentContent()});function quarterChange(){const a=document.getElementById("quarter");writeCookie("monkeyWebSelectedQuarter",a.options[a.selectedIndex].value),getAllStudentContent()}function registrationStateChange(){const a=document.getElementById("stage");writeCookie("monkeyWebSelectedStage",a.value),getAllStudentContent()}function getAllStudentContent(){getConfig().then(a=>{document.getElementById("currentStudentLabel").innerHTML="Current Student: "+(a.nextStudentID-1),loadSelectedMenu(a)})}function loadSelectedMenu(a){const b=document.getElementById("stage");let c=getCookieDict(),d=[{value:"all",text:"No filter"},{value:"allStage",text:"Exclude unregist"},{value:"unregistered",text:"Unregistered"},{value:"untransferred",text:"Untransferred"},{value:"transferred",text:"Transferred"},{value:"approved",text:"Approved"},{value:"rejected",text:"Rejected"},{value:"pending",text:"Pending"},{value:"finished",text:"Finished"}];b.innerHTML="";for(let g=0;g<d.length;g++)b.innerHTML+="<option value = '"+d[g].value+"'>"+d[g].text+"</option>";b.value=void 0===c.monkeyWebSelectedStage?"all":c.monkeyWebSelectedStage;const e=document.getElementById("quarter");e.innerHTML="";let f="";position(c.monkeyWebUser).then(g=>{switch(g.position){case"tutor":case"admin":f="protected";break;case"dev":case"mel":f="private";}listQuarter(f).then(h=>{for(let k=0;k<h.quarter.length;k++)e.innerHTML+="<option value = '"+h.quarter[k].year+"-"+h.quarter[k].quarter+"'>"+h.quarter[k].name+"</option>";e.value=void 0===c.monkeyWebSelectedQuarter?a.defaultQuarter.quarter.year+"-"+a.defaultQuarter.quarter.quarter:c.monkeyWebSelectedQuarter;let j=$("#quarter").val();$.post("post/v1/allStudent",{year:j.slice(0,4),quarter:j.slice(5)}).then(k=>{if(k.err)log("[getAllStudentContent()] : post/allStudent => "+k.err);else{log("[getAllStudentContent()] : post/allStudent => ");for(let m=0;m<k.users.length;m++)studentForSearch.push({name:k.users[m].nickname+" "+k.users[m].firstname,id:k.users[m].studentID});const l=$(".typeahead");l.typeahead({source:studentForSearch,autoSelect:!0}),l.change(function(){let m=l.typeahead("getActive");m&&(writeCookie("monkeyWebAdminAllstudentSelectedUser",m.id),self.location="/adminStudentprofile")}),position(getCookieDict().monkeyWebUser).then(m=>{let n="public";switch(m.position){case"tutor":case"admin":n="protected";break;case"dev":n="private";}listQuarter(n).then(o=>{generateStudentHtmlTable(filterData(k.users,o,a))})})}})})})}function filterData(a,b,c){let d=document.getElementById("quarter"),e=document.getElementById("status"),f=document.getElementById("stage"),g=document.getElementById("grade"),h=document.getElementById("course"),j=getCookieDict();void 0===j.monkeyWebSelectedQuarter&&(j.monkeyWebSelectedQuarter=c.defaultQuarter.quarter.year+"-"+c.defaultQuarter.quarter.quarter);let k=parseInt(j.monkeyWebSelectedQuarter.substring(0,j.monkeyWebSelectedQuarter.indexOf("-"))),l=parseInt(j.monkeyWebSelectedQuarter.substring(j.monkeyWebSelectedQuarter.indexOf("-")+1));return a=a.filter(m=>{if("all"!==f.options[f.selectedIndex].value){let n="unregistered";for(let o=0;o<m.quarter.length;o++)k===m.quarter[o].year&&l===m.quarter[o].quarter&&(n=m.quarter[o].registrationState);return"allStage"===f.options[f.selectedIndex].value&&"unregistered"!==n||f.options[f.selectedIndex].value===n}return!0}),"all"!==e.options[e.selectedIndex].value&&("default"===e.options[e.selectedIndex].value?a=a.filter(m=>{return"active"===m.status||"dropped"===m.status}):a=a.filter(m=>{return m.status===e.options[e.selectedIndex].value})),"all"!==g.options[g.selectedIndex].value&&(a=a.filter(m=>m.grade===parseInt(g.options[g.selectedIndex].value))),"none"!==h.options[h.selectedIndex].value&&(a=a.filter(m=>{switch(h.options[h.selectedIndex].value){case"hb":return m.inHybrid;case"cr":return m.inCourse;case"all":return m.inCourse&&m.inHybrid;default:}})),a}$("#checkTableColumm").click(function(){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23 reset \u0E17\u0E31\u0E49\u0E07\u0E2B\u0E21\u0E14?")&&$.post("post/v1/resetRemark").then(()=>{location.reload()})});function scanStudentBarcode(){let a=document.getElementById("studentID");writeCookie("monkeyWebAdminAllstudentSelectedUser",a.value.substring(0,a.value.length-1)),self.location="/adminStudentprofile"}function createNewStudent(){$.post("/post/addBlankStudent",{number:1}).then(a=>{log(a),document.getElementById("newStudentUsername").innerHTML="Username: "+a.student[0].studentID,document.getElementById("newStudentPassword").innerHTML="Password: "+a.student[0].password,$("#newStudentDialog").modal({backdrop:"static",keyboard:!1})})}function closeNewStudentDialog(){$("#newStudentDialog").modal("hide"),location.reload()}