let generateStudent=(()=>{var a=_asyncToGenerator(function*(b){let c;try{c=yield $.post("post/courseInfo",{courseID:b})}catch(f){return void alert("Error to get course info, try again later.")}let d=[];for(let f in c.student)d.push($.post("post/name",{userID:c.student[f]}));let e;try{e=yield Promise.all(d)}catch(f){return void alert("Error to get user name, try again later.")}for(let f in c.student)c.student[f]={id:c.student[f],nickname:e[f].nickname,firstname:e[f].firstname,nicknameEn:e[f].nicknameEn,firstnameEn:e[f].firstnameEn};addRatingInput(c)});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var h=b[f](g),j=h.value}catch(k){return void d(k)}return h.done?void c(j):Promise.resolve(j).then(function(k){e("next",k)},function(k){e("throw",k)})}return e("next")})}}$("#form-container").hide(),$("#button-container").hide(),$("#cr-select").change(function(){0==this.value?($("#form-container").hide(),$("#button-container").hide(),$("#fetch-container").show()):(generateStudent(this.value),$("#form-container").show(),$("#button-container").show(),$("#fetch-container").hide())}),addRatingInput=a=>{let b=$("#student-container");b.empty();let c=a.student;for(let f in c)b.append("<div class='card' style='margin-bottom:8px'><div class='card-body'><div class='row'><div class='col-6'>"+c[f].nickname+" "+c[f].firstname+"</div><div class='col-6'><div class='form-check form-check-inline float-right'><input class='form-check-input' type='checkbox' value='"+c[f].id+"-check-form'><label class='form-check-label'>Absent</label></div></div></div><div class='row' style='margin-bottom:-15px; margin-top:15px;'><div class='col-12 col-md-6' style=\"background-color:"+"#E1F5FE"+";padding:8px 15px 8px 15px;\"><label style='margin-bottom:0'><span class='fas fa-book-open'></span> Study</label><label style='margin-bottom:0' class='float-right' id="+c[f].id+"-std-score>2.5</label><input type='range' class='custom-range' min='0' max='5' step='0.5' id="+c[f].id+"-std-range></div><div class='col-12 col-md-6' style=\"background-color:"+"#FFF59D"+";padding:8px 15px 8px 15px;\"><label style='margin-bottom:0'><span class='fas fa-crown'></span> Behavior</label><label style='margin-bottom:0' class='float-right' id="+c[f].id+"-bv-score>2.5</label><input type='range' class='custom-range' min='0' max='5' step='0.5' id="+c[f].id+"-bv-range></div></div></div></div>")},$(document).on("input",".custom-range",function(){let a=this.id.slice(0,this.id.lastIndexOf("-"));$("#"+a+"-score").html(this.value)}),$("#submit-btn").click(function(){let a=$(".custom-range"),b=$(".form-check-input:checked"),c=[];for(let g,f=0;f<b.length;f++)g=b[f].value,c.push(g.slice(0,g.indexOf("-")));let d={type:"study",scores:[],courseID:$("#cr-select").val()},e={type:"behavior",scores:[],courseID:$("#cr-select").val()};for(let f=0;f<a.length;f++){let g=a[f].id,h=g.slice(g.indexOf("-")+1,g.lastIndexOf("-")),j=g.slice(0,g.indexOf("-"));if(0>c.indexOf(j))switch(h){case"bv":e.scores.push({studentID:j,score:a[f].value});break;case"std":d.scores.push({studentID:j,score:a[f].value});break;default:}}try{Promise.all([$.post("v2/rating/addMany",d),$.post("v2/rating/addMany",e)]).then(()=>{alert("Rating successful."),location.reload()})}catch(f){alert("Rating error, try again later.")}});