let generateStudent=(()=>{var a=_asyncToGenerator(function*(b){let c;try{c=yield $.post("post/courseInfo",{courseID:b})}catch(g){return void alert("Error to get course info, try again later.")}let d=[];for(let g in c.student)d.push($.post("post/name",{userID:c.student[g]}));let f;try{f=yield Promise.all(d)}catch(g){return void alert("Error to get user name, try again later.")}for(let g in c.student)c.student[g]={id:c.student[g],nickname:f[g].nickname,firstname:f[g].firstname,nicknameEn:f[g].nicknameEn,firstnameEn:f[g].firstnameEn};addRatingInput(c)});return function(){return a.apply(this,arguments)}})(),getTypeaheadData=(()=>{var a=_asyncToGenerator(function*(){let b=yield allStudent();b=b.student;let c=b.map(function(d){let f={name:d.nickname+" "+d.firstname+" ("+d.studentID+")",id:d.studentID};return f});$(".search-std").typeahead({source:c,autoSelect:!0})});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function f(g,h){try{var j=b[g](h),k=j.value}catch(l){return void d(l)}return j.done?void c(k):Promise.resolve(k).then(function(l){f("next",l)},function(l){f("throw",l)})}return f("next")})}}$(".cr-blog").hide(),getTypeaheadData(),$("#cr-select").change(function(){0==this.value?$(".cr-blog").fadeOut(400,()=>{$(".solo-blog").show()}):(generateStudent(this.value),$(".solo-blog").fadeOut(400,()=>{$(".cr-blog").show()}))}),addRatingInput=a=>{let b=$("#student-container");b.empty();let c=a.student;for(let g in c)b.append("<div class='card' style='margin-bottom:8px'><div class='card-body'><div class='row'><div class='col-6'>"+c[g].nickname+" "+c[g].firstname+"</div><div class='col-6'><div class='form-check form-check-inline float-right'><input class='form-check-input' type='checkbox' value='"+c[g].id+"-check-form'><label class='form-check-label'>Absent</label></div></div></div><div class='row' style='margin-bottom:-15px; margin-top:15px;'><div class='col-12 col-md-6' style=\"background-color:"+"#E1F5FE"+";padding:8px 15px 8px 15px;\"><label style='margin-bottom:0'><span class='fas fa-book-open'></span> Study</label><label style='margin-bottom:0' class='float-right' id="+c[g].id+"-std-score>5</label><input type='range' class='custom-range cr-range' min='0' max='5' step='0.5' id="+c[g].id+"-std-range></div><div class='col-12 col-md-6' style=\"background-color:"+"#FFF59D"+";padding:8px 15px 8px 15px;\"><label style='margin-bottom:0'><span class='fas fa-crown'></span> Behavior</label><label style='margin-bottom:0' class='float-right' id="+c[g].id+"-bv-score>5</label><input type='range' class='custom-range cr-range' min='0' max='5' step='0.5' id="+c[g].id+"-bv-range></div></div></div></div>");$(".cr-range").val(5)},$(document).on("input",".cr-range",function(){let a=this.id.slice(0,this.id.lastIndexOf("-"));$("#"+a+"-score").html(this.value)}),$("#submit-btn").click(function(){let a=$(".cr-range"),b=$(".form-check-input:checked"),c=[];for(let h,g=0;g<b.length;g++)h=b[g].value,c.push(h.slice(0,h.indexOf("-")));let d={type:"study",scores:[],courseID:$("#cr-select").val()},f={type:"behavior",scores:[],courseID:$("#cr-select").val()};for(let g=0;g<a.length;g++){let h=a[g].id,j=h.slice(h.indexOf("-")+1,h.lastIndexOf("-")),k=h.slice(0,h.indexOf("-"));if(0>c.indexOf(k))switch(j){case"bv":f.scores.push({studentID:k,score:a[g].value});break;case"std":d.scores.push({studentID:k,score:a[g].value});break;default:}}try{Promise.all([$.post("v2/rating/addMany",d),$.post("v2/rating/addMany",f)]).then(()=>{alert("Rating successful."),location.reload()})}catch(g){alert("Rating error, try again later.")}}),$("#solo-std-range").val(5),$("#solo-bv-range").val(5),$("#solo-std-range").on("input",function(){$("#solo-std-score").html(this.value)}),$("#solo-bv-range").on("input",function(){$("#solo-bv-score").html(this.value)}),$("#submit-solo-btn").click(function(){let a=$(".search-std").typeahead("getActive");if(a){let b={studentID:a.id,type:"study",score:$("#solo-std-range").val()},c={studentID:a.id,type:"behavior",score:$("#solo-bv-range").val()};try{Promise.all([$.post("v2/rating/add",b),$.post("v2/rating/add",c)]).then(()=>{alert("Rating successful."),location.reload()})}catch(d){alert("Rating error, try again later.")}}});