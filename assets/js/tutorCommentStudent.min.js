$(document).ready(function(){$('body').on('touchstart.dropdown','.dropdown-menu',function(f){f.stopPropagation()});var a=[];$.post('post/allStudent').then(f=>{for(let g=0;g<f.student.length;g++)'active'===f.student[g].status&&a.push(f.student[g].nickname+' '+f.student[g].firstname+'('+f.student[g].studentID+')');$('.typeahead').typeahead({source:a})}),$('#uploadButton').click(function(){$('#uploadModal').modal()}),$('#postButton').click(function(){let f=$('#search-box .typeahead').typeahead('getActive'),g=$('#file-1'),h=g.val().split('.').pop().toLowerCase();if(!(f!==void 0))alert('Please Input Student Name');else if(7<f.length){let j=new FormData;if(j.append('studentID',f.slice(-6,-1)),j.append('tutorID',c),j.append('message',$('#comment').val()),log(h),''===h)log('No Picture'),$.ajax({url:'post/addStudentComment',type:'POST',data:j,processData:!1,contentType:!1,success:function(){location.reload()}});else if(-1===$.inArray(h,['png','jpg','jpeg']))alert('\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19');else{let k=g.get(0).files;if(0<k.length){for(let m,l=0;l<k.length;l++)m=k[l],j.append('attachment',m,m.name);$.ajax({url:'post/addStudentComment',type:'POST',data:j,processData:!1,contentType:!1,success:function(){location.reload()}})}}}else alert('Please Select Correct Name')});let b=getCookieDict(),c=b.monkeyWebUser,d;writeCookie('commIndex',0),b=getCookieDict(),genPagination(1),$.post('post/position',{userID:c}).then(f=>{d=f.position,writeCookie('pos',d),showComment(d,parseInt(b.commIndex))})});function showComment(a,b){writeCookie('commIndex',b),$.post('post/listStudentCommentByIndex',{start:b,limit:20}).then(c=>{genPagination(b/20+1),$('#commentList').empty(),20>c.comment.length?$('.next').addClass('disabled'):20===c.comment.length?$.post('post/listStudentCommentByIndex',{start:b+20,limit:1}).then(d=>{0===d.comment.length?$('.next').addClass('disabled'):$('.next').removeClass('disabled')}):$('.next').removeClass('disabled'),0===parseInt(b)?$('.previous').addClass('disabled'):$('.previous').removeClass('disabled'),0===c.comment.length&&showComment(a,b-20),'tutor'===a?getName(c,0):getNameAdmin(c,0)})}function getName(a,b){$.post('post/name',{userID:a.comment[b].tutorID}).then(c=>{$.post('post/name',{userID:a.comment[b].studentID}).then(d=>{let f=moment(a.comment[b].timestamp,'x').format('DD MMM'),g='<h6><span class=\'oi oi-pin\''+(0<a.comment[b].priority?'style=\'color:red\'':'style=\'color:silver\'')+'></span><span class=\'oi oi-check\''+(a.comment[b].isCleared?'style=\'color:green\'':'style=\'color:silver\'')+'></span>'+c.nickname+' -> '+d.nickname+' '+d.firstname+' ('+f+') </h6>';$('#commentList').append(g),$('#commentList').append('<p>'+a.comment[b].message+'</p>'),a.comment[b].hasAttachment?$.post('post/getConfig').then(h=>{let j=h.studentCommentPicturePath;j=j.slice(j.search('MonkeyWebData')+14)+a.comment[b].commentID,$.get(j+'.jpg').done(function(){$('#commentList').append('<div class=\'row\'><img class=\'col-sm-4 col-xs-10\' src=\''+j+'.jpg\' class=\'img-thumbnail\'></div>'),b<a.comment.length-1&&getName(a,b+1)}).fail(function(){$.get(j+'.jpeg').done(function(){$('#commentList').append('<div class=\'row\'><img class=\'col-sm-4 col-xs-10\' src=\''+j+'.jpeg\' class=\'img-thumbnail\'></div>'),b<a.comment.length-1&&getName(a,b+1)}).fail(function(){$.get(j+'.png').done(function(){$('#commentList').append('<div class=\'row\'><img class=\'col-sm-4 col-xs-10\' src=\''+j+'.png\' class=\'img-thumbnail\'></div>'),b<a.comment.length-1&&getName(a,b+1)}).fail(function(){b<a.comment.length-1&&getName(a,b+1)})})})}):b<a.comment.length-1&&getName(a,b+1)})})}function getNameAdmin(a,b){$.post('post/name',{userID:a.comment[b].tutorID}).then(c=>{$.post('post/name',{userID:a.comment[b].studentID}).then(d=>{let f=moment(a.comment[b].timestamp,'x').format('DD MMM'),g='<h6><span class=\'oi oi-pin\''+(0<a.comment[b].priority?'style=\'color:red\'':'style=\'color:silver\'')+'onClick=\'pin("'+a.comment[b].commentID+'",'+(0<a.comment[b].priority?0:1)+');\'></span><span class=\'oi oi-check\''+(a.comment[b].isCleared?'style=\'color:green\'':'style=\'color:silver\'')+'onClick=\'clearComm("'+a.comment[b].commentID+'",'+(a.comment[b].isCleared?0:1)+');\'></span>'+c.nickname+' -> '+d.nickname+' '+d.firstname+' ('+f+') <span class=\'oi oi-trash\' style=\'color:red\' onClick=\'rmComm("'+a.comment[b].commentID+'");\'></span></h6>';$('#commentList').append(g),$('#commentList').append('<p>'+a.comment[b].message+'</p>'),a.comment[b].hasAttachment?$.post('post/getConfig').then(h=>{let j=h.studentCommentPicturePath;j=j.slice(j.search('MonkeyWebData')+14)+a.comment[b].commentID,$.get(j+'.jpg').done(function(){$('#commentList').append('<div class=\'row\'><img class=\'col-sm-4 col-xs-10\' src=\''+j+'.jpg\' class=\'img-thumbnail\'></div>'),b<a.comment.length-1&&getNameAdmin(a,b+1)}).fail(function(){$.get(j+'.jpeg').done(function(){$('#commentList').append('<div class=\'row\'><img class=\'col-sm-4 col-xs-10\' src=\''+j+'.jpeg\' class=\'img-thumbnail\'></div>'),b<a.comment.length-1&&getNameAdmin(a,b+1)}).fail(function(){$.get(j+'.png').done(function(){$('#commentList').append('<div class=\'row\'><img class=\'col-sm-4 col-xs-10\' src=\''+j+'.png\' class=\'img-thumbnail\'></div>'),b<a.comment.length-1&&getNameAdmin(a,b+1)}).fail(function(){b<a.comment.length-1&&getNameAdmin(a,b+1)})})})}):b<a.comment.length-1&&getNameAdmin(a,b+1)})})}function clearComm(a,b){let c=getCookieDict(),d=c.pos;log(a+','+b),$.post('post/clearStudentComment',{commentID:a,isCleared:b}).then(()=>{showComment(d,parseInt(c.commIndex))})}function pin(a,b){let c=getCookieDict(),d=c.pos;$.post('post/changeStudentCommentPriority',{commentID:a,priority:b}).then(()=>{showComment(d,parseInt(c.commIndex))})}function rmComm(a){let b=getCookieDict(),c=b.pos;!0===confirm('\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A comment \u0E19\u0E35\u0E49')&&$.post('post/removeStudentComment',{commentID:a}).then(()=>{showComment(c,parseInt(b.commIndex))})}function genPagination(a){$('.pagination').empty();let b=getCookieDict(),c=b.pos;if($('.pagination').append('<li class=\'page-item previous\'><a class=\'page-link\' onClick=\'commFirst()\'>First</a></li>'),$('.pagination').append('<li class=\'page-item previous\'><a class=\'page-link\' onClick=\'commPosition(0)\'>Previous</a></li>'),3>=a)for(let d=1;6>d;d++)$('.pagination').append('<li class=\'page-item\' id=\'page'+d+'\'><a class=\'page-link\' onClick="showComment(\''+c+'\','+20*(d-1)+')">'+d+'</a></li>');else for(let d=a-2;d<a+3;d++)$('.pagination').append('<li class=\'page-item\' id=\'page'+d+'\'><a class=\'page-link\' onClick="showComment(\''+c+'\','+20*(d-1)+')">'+d+'</a></li>');$('.pagination').append('<li class=\'page-item next\'><a class=\'page-link\' onClick=\'commPosition(1)\'>Next</a></li>'),$('.pagination').append('<li class=\'page-item next\'><a class=\'page-link\' onClick=\'commLast()\'>Last</a></li>'),$('#page'+a).addClass('active')}function commFirst(){let a=getCookieDict(),b=a.pos;showComment(b,0)}function commLast(){alert('This function can\'t use now')}function commPosition(a){let b=getCookieDict(),c;c=0<a?parseInt(b.commIndex)+20:parseInt(b.commIndex)-20;let d=b.pos;showComment(d,c)}