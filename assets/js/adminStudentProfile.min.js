let loadProfileImg=(()=>{var a=_asyncToGenerator(function*(){let b=yield getConfig(),c=b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+ID;$.get(c+".jpg").done(function(){$("#profileImg").attr("src",c+".jpg")}).fail(function(){$.get(c+".png").done(function(){$("#profileImg").attr("src",c+".png")}).fail(function(){$.get(c+".jpeg").done(function(){$("#profileImg").attr("src",c+".jpeg")}).fail(function(){log("can't find picture")})})})});return function(){return a.apply(this,arguments)}})(),loadRecieptImg=(()=>{var a=_asyncToGenerator(function*(){let b=yield getConfig(),c=$("#quarterSelect option:selected").text(),d=b.receiptPath.slice(b.receiptPath.search("MonkeyWebData")+14)+c+"/"+ID;$.get(d+".jpg").done(function(){$("#recieptImg").attr("src",d+".jpg")}).fail(function(){$.get(d+".png").done(function(){$("#recieptImg").attr("src",d+".png")}).fail(function(){$.get(d+".jpeg").done(function(){$("#recieptImg").attr("src",d+".jpeg")}).fail(function(){log("can't find picture"),$("#recieptImg").attr("src","images/nopic.png")})})})});return function(){return a.apply(this,arguments)}})(),genQuarterSelect=(()=>{var a=_asyncToGenerator(function*(){let b=yield listQuarter("private");for(let d in b.quarter)$("#quarterSelect").append("<option value="+b.quarter[d].year+"-"+b.quarter[d].quarter+">"+b.quarter[d].name+"</option>");let c=getCookieDict();if(c.monkeyWebSelectedQuarter===void 0){let d=yield getConfig(),e=d.defaultQuarter.quarter.year+"-"+d.defaultQuarter.quarter.quarter;$("#quarterSelect").val(e),writeCookie("monkeyWebSelectedQuarter",e)}else $("#quarterSelect").val(c.monkeyWebSelectedQuarter);genStudentData(),loadRecieptImg(),showChatData()});return function(){return a.apply(this,arguments)}})(),genStudentData=(()=>{var a=_asyncToGenerator(function*(){let b=$("#quarterSelect").val();writeCookie("courseQuarter",b);let c=yield studentProfile(ID);$("#studentProfileContent").empty(),$("#studentProfileContent").append("<h4>"+c.firstname+" ("+c.nickname+") "+c.lastname+"</h4><h4>"+c.firstnameEn+" ("+c.nicknameEn+") "+c.lastnameEn+"</h4><h4><span class='fas fa-fw fa-lg fa-graduation-cap'></span> "+(6<c.grade?"S"+(c.grade-6):"P"+c.grade)+" <span class='far fa-fw fa-lg fa-id-card'></span> "+ID+"</h4><h5>Level: "+c.level+"</h5><h5><span class='far fa-fw fa-lg fa-envelope'></span> "+c.email+"</h5><h5><span class='fas fa-fw fa-lg fa-phone'></span> Student: "+c.phone+"</h5><h5><span class='fas fa-fw fa-lg fa-phone'></span> Parent: "+c.phoneParent+"</h5>"),10<parseInt(b.slice(5))?($("#smCoverDowload").show(),$("#mathCoverDowload").hide(),$("#phyCoverDowload").hide(),$("#cheCoverDowload").hide(),$("#engCoverDowload").hide()):($("#smCoverDowload").hide(),$("#mathCoverDowload").show(),$("#phyCoverDowload").show(),$("#cheCoverDowload").show(),$("#engCoverDowload").show()),genStatusPanel(c.status,c.quarter),genStudentTable(),genChangeInfoModal(c)});return function(){return a.apply(this,arguments)}})(),genStatusPanel=(()=>{var a=_asyncToGenerator(function*(b,c){let d=getCookieDict(),e=$("#statusButton"),f=$("#statusDropdown"),g=$("#statusSubButton");switch(e.removeClass("btn-danger btn-success btn-secondary btn-dark"),f.empty(),g.empty(),b){case"active":e.html("ACTIVE").addClass("btn-success"),g.append("<button class='col-12 btn btn-light subButt-unregistered' onclick=\"changeStudentState('unregistered')\">UNREGISTER</button><button class='col-12 btn btn-light subButt-untransferred' onclick=\"changeStudentState('untransferred')\">UNTRANSFER</button><button class='col-12 btn btn-light subButt-rejected' onclick=\"changeStudentState('rejected');\">REJECT</button><button class='col-12 btn btn-light subButt-transferred' onclick=\"changeStudentState('transferred')\">TRANSFER</button><button class='col-12 btn btn-light subButt-approved' onclick=\"changeStudentState('approved')\">APPROVE</button><button class='col-12 btn btn-light subButt-pending' onclick=\"changeStudentState('pending')\">PENDING</button><button class='col-12 btn btn-light subButt-finished' onclick=\"changeStudentState('finished');\">FINISH</button>");break;case"inactive":e.html("INACTIVE").addClass("btn-secondary"),g.append("<button class='col-12 btn btn-light'>Please login and fill profile data</button>");break;case"dropped":e.html("DROP").addClass("btn-danger"),g.append("<button class='col-12 btn btn-danger'>PENDING</button><button class='col-12 btn btn-light' onclick=\"changeStudentStatus('active')\">EDITED</button><button class='col-12 btn btn-light' onclick=\"changeStudentStatus('terminated')\">TERMINATE</button>");break;case"terminated":e.html("TERMINATE").addClass("btn-dark"),g.append("<button class='col-12 btn btn-light'>Please active again for regis</button>");break;default:}f.append("<a class='dropdown-item' onclick=\"changeStudentStatus('active')\">ACTIVE</a><a class='dropdown-item' onclick=\"changeStudentStatus('dropped')\">DROP</a>");let j=d.courseQuarter;if(void 0!=c){let k=!0;for(let l in c)c[l].year==j.slice(0,4)&&c[l].quarter==j.slice(5)&&(k=!1,$(".subButt-"+c[l].registrationState).removeClass("btn-light").addClass("btn-success"));k&&$(".subButt-unregistered").removeClass("btn-light").addClass("btn-success")}else{let k=yield studentProfile(ID);c=k.quarter,genStatusPanel(b,c)}});return function(){return a.apply(this,arguments)}})(),genStudentTable=(()=>{var a=_asyncToGenerator(function*(){let b=!1,c=!1,d=!1,e=!1,f=$("#quarterSelect").val();$(".selector").html("ADD SUBJ").removeClass("cr hb sk"),10<parseInt(f.slice(5))?($("#mainTable").collapse("hide"),$("#summerTable").collapse("show")):($("#mainTable").collapse("show"),$("#summerTable").collapse("hide"));let g=yield $.post("post/v1/studentTimeTable",{studentID:ID,year:f.slice(0,4),quarter:f.slice(5)});for(let j in g.course){let k=moment(g.course[j].day),l="Hybrid"==g.course[j].tutorName?"HB":g.course[j].tutorName;if($(".btn"+k.day()+k.hour()).html("CR:"+g.course[j].courseName+" - "+l).addClass("cr").attr("id",g.course[j].courseID),"Hybrid"==g.course[j].tutorName)switch(g.course[j].courseName.slice(0,1)){case"M":b=!0;break;case"P":c=!0;break;case"C":d=!0;break;case"E":e=!0;break;default:}}for(let j in g.hybrid){let k=moment(g.hybrid[j].day);switch($(".btn"+k.day()+k.hour()).html("FHB:"+g.hybrid[j].subject).addClass("hb").attr("id",g.hybrid[j].hybridID),g.hybrid[j].subject){case"M":b=!0;break;case"P":c=!0;break;case"C":d=!0;break;case"E":e=!0;break;default:}}for(let j in g.skill){let k=moment(g.skill[j].day);9==k.hour()&&k.hour(8),11==k.hour()&&k.hour(10),14==k.hour()&&k.hour(13),$(".btn"+k.day()+k.hour()).html("SKILL:"+g.skill[j].subject).addClass("sk").attr("id",g.skill[j].skillID)}genBarcode(),genTableTemplate(b,c,d,e)});return function(){return a.apply(this,arguments)}})(),genBarcode=(()=>{var a=_asyncToGenerator(function*(){JsBarcode("#mathBarcode",ID+"1",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#phyBarcode",ID+"2",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#cheBarcode",ID+"3",{lineColor:"black",width:3.4,height:68,displayValue:!1}),JsBarcode("#engBarcode",ID+"4",{lineColor:"black",width:3.4,height:68,displayValue:!1})});return function(){return a.apply(this,arguments)}})(),genTableTemplate=(()=>{var a=_asyncToGenerator(function*(b,c,d,e){let f=yield studentProfile(ID),g="images/TableCover/",j=6<f.grade?"h":"j";b&&(g+="m",$("#mathCoverDowload").removeClass("disabled")),c&&(g+="p",$("#phyCoverDowload").removeClass("disabled")),d&&(g+="c",$("#cheCoverDowload").removeClass("disabled")),e&&(g+="e",$("#engCoverDowload").removeClass("disabled")),g+=j+".png",$("#tableTemplate").attr("src",g)});return function(){return a.apply(this,arguments)}})(),genCover=(()=>{var a=_asyncToGenerator(function*(b){let c=$("#quarterSelect").val();if((4===b||5===b)&&10<parseInt(c.slice(5)))return void(4===b?genSmAppRej(1):genSmAppRej(2));let j,k,[d,e,f,g]=yield Promise.all([studentProfile(ID),$.post("post/v1/studentTimeTable",{studentID:ID,year:c.slice(0,4),quarter:c.slice(5)}),$.post("/v2/student/getRegistrationQuarter",{studentID:ID}),listQuarter("private")]);0===b?(j=document.getElementById("mathCover"),k=document.getElementById("mathBarcode")):1===b?(j=document.getElementById("phyCover"),k=document.getElementById("phyBarcode")):2===b?(j=document.getElementById("cheCover"),k=document.getElementById("cheBarcode")):3===b?(j=document.getElementById("engCover"),k=document.getElementById("engBarcode")):(j=document.getElementById("mathCover"),k=document.getElementById("mathBarcode"));let l=j.getContext("2d"),m=document.getElementById("tableTemplate");l.drawImage(m,0,0,1654,1170),l.textAlign="center",l.textBaseline="middle",l.font="bold 150px Cordia New",l.fillText(6<d.grade?"S"+(d.grade-6):"P"+d.grade,117,85);let n=document.getElementById("profileImg"),o=184,p=n.width*o/n.height;switch(l.drawImage(n,204,30,p,o),l.font="bold 80px Cordia New",b){case 0:l.fillText("ID: "+ID+"1",1025,63);break;case 1:l.fillText("ID: "+ID+"2",1025,63);break;case 2:l.fillText("ID: "+ID+"3",1025,63);break;case 3:l.fillText("ID: "+ID+"4",1025,63);break;default:l.fillText("ID: "+ID+"1",1025,63);}l.drawImage(k,900,115),l.fillText(d.firstname+" ("+d.nickname+")",600,80),l.fillText(d.lastname,600,170);let q=[1289,1508,835,1064],r=[383,508,633,758,875],s=[1335,1416,1498,1580],u=[140,220,300,380,460];for(let A in l.font="bold 60px Cordia New",l.fillStyle="#f442df",e.course)l.fillText("CR: "+e.course[A].courseName,q[dayIndex(e.course[A].day)],r[hourIndex(e.course[A].day)]),l.fillText("Hybrid"==e.course[A].tutorName?"HB":e.course[A].tutorName,q[dayIndex(e.course[A].day)],r[hourIndex(e.course[A].day)]+60),"Hybrid"==e.course[A].tutorName&&(0==b&&"M"==e.course[A].courseName.slice(0,1)?l.fillText("CR",s[dayIndex(e.course[A].day)],u[hourIndex(e.course[A].day)]):1==b&&"P"==e.course[A].courseName.slice(0,1)?l.fillText("CR",s[dayIndex(e.course[A].day)],u[hourIndex(e.course[A].day)]):2==b&&"C"==e.course[A].courseName.slice(0,1)?l.fillText("CR",s[dayIndex(e.course[A].day)],u[hourIndex(e.course[A].day)]):3==b&&"E"==e.course[A].courseName.slice(0,1)&&l.fillText("CR",s[dayIndex(e.course[A].day)],u[hourIndex(e.course[A].day)]));for(let A in e.hybrid)l.fillStyle="#242de2",l.fillText("FHB: "+e.hybrid[A].subject,q[dayIndex(e.hybrid[A].day)],r[hourIndex(e.hybrid[A].day)]),l.fillText("HB",q[dayIndex(e.hybrid[A].day)],r[hourIndex(e.hybrid[A].day)]+60),l.fillStyle="black",0==b&&"M"==e.hybrid[A].subject?l.fillText("HB",s[dayIndex(e.hybrid[A].day)],u[hourIndex(e.hybrid[A].day)]):1==b&&"P"==e.hybrid[A].subject?l.fillText("HB",s[dayIndex(e.hybrid[A].day)],u[hourIndex(e.hybrid[A].day)]):2==b&&"C"==e.hybrid[A].subject?l.fillText("HB",s[dayIndex(e.hybrid[A].day)],u[hourIndex(e.hybrid[A].day)]):3==b&&"E"==e.hybrid[A].subject&&l.fillText("HB",s[dayIndex(e.hybrid[A].day)],u[hourIndex(e.hybrid[A].day)]);for(let A in l.font="bold 50px Cordia New",l.fillStyle="orange",e.skill){let B=moment(e.skill[A].day);"ME"==e.skill[A].subject?(l.fillText("SK: M "+B.format("H:00"),q[dayIndex(e.skill[A].day)],r[hourIndex(e.skill[A].day)]),l.fillText("SK: E "+B.format("H:30"),q[dayIndex(e.skill[A].day)],r[hourIndex(e.skill[A].day)]+60)):9==B.hour()||11==B.hour()||14==B.hour()||16==B.hour()?l.fillText("SK: "+e.skill[A].subject+" "+B.format("H:mm"),q[dayIndex(e.skill[A].day)],r[hourIndex(e.skill[A].day)]+70):l.fillText("SK: "+e.skill[A].subject+" "+B.format("H:mm"),q[dayIndex(e.skill[A].day)],r[hourIndex(e.skill[A].day)])}l.fillStyle="black",l.textAlign="left";let v=_.union(f.registration.course,f.registration.hybrid),x=0;for(let A in g.quarter){let B=A<g.quarter.length-1;-1<v.indexOf(g.quarter[A].quarterID)&&(10>g.quarter[A].quarter?(l.font="50px Cordia New",l.fillText(g.quarter[A].name+(B?" / ":""),35+x,244)):(l.font="bold 50px Cordia New",l.fillText(g.quarter[A].name,35+x,244),l.font="50px Cordia New",B&&(l.fillText(" / ",185+x,244),x+=30)),x+=145)}if(l.fillStyle="black",l.textAlign="center",l.font="bold 50px Cordia New",4==b||5==b){if(4==b)var z=document.getElementById("appRejCover1");else var z=document.getElementById("appRejCover2");let A=z.getContext("2d"),B=document.getElementById("recieptImg"),C=1654,D=B.height*C/B.width;A.drawImage(B,0,0,C,D);let E=document.getElementById("mathCover");A.globalAlpha=0.5,A.drawImage(E,0,0,1654,1170),A.globalAlpha=1,A.font="bold 400px Cordia New",A.rotate(Math.PI/6),4==b?(A.fillStyle="red",A.fillText("REJECT",350,200)):5==b&&(A.fillStyle="green",A.fillText("FINISHED",350,200)),downloadCanvas(b)}else downloadCanvas(b)});return function(){return a.apply(this,arguments)}})(),genSummerCover=(()=>{var a=_asyncToGenerator(function*(b){let c=$("#quarterSelect").val(),d=moment(0);d.date(12).month(2).year(2018).hour(3);let e=moment(0);e.date(30).month(2).year(2018).hour(23);let k,[f,g,j]=yield Promise.all([listQuarter("private"),$.post("post/v1/studentTimeTable",{studentID:ID,year:c.slice(0,4),quarter:c.slice(5)}),name(ID)]);for(let q in f.quarter)f.quarter[q].year===parseInt(c.slice(0,4))&&f.quarter[q].quarter===parseInt(c.slice(5))&&(k=f.quarter[q]);let l=document.getElementById("smCover"),m=l.getContext("2d"),n=document.getElementById("smTableTemplate");m.drawImage(n,0,0,1241,880),m.textAlign="center",m.textBaseline="middle",m.font="bold 180px Cordia New",m.fillText(k.name,340,88),m.font="bold 85px Cordia New",1===b?m.fillText(ID+"1",1070,77):2==b&&m.fillText(ID+"2",1070,77),m.font="bold 60px Cordia New",m.fillText(j.firstname+" ("+j.nickname+")",980,172),m.font="bold 150px Cordia New";let o=g.course,p={8:350,10:530,13:710};for(let q in m.textAlign="left",o){let r=moment(o[q].day);m.fillText(o[q].courseName+" - "+o[q].tutorName,370,p[r.hour()])}1===b?downloadCanvas(6):2==b&&downloadCanvas(7)});return function(){return a.apply(this,arguments)}})(),genSmAppRej=(()=>{var a=_asyncToGenerator(function*(b){let c=$("#quarterSelect").val(),d=yield $.post("post/v1/studentTimeTable",{studentID:ID,year:c.slice(0,4),quarter:c.slice(5)}),e=document.getElementById("smAppRejCover"),f=document.getElementById("recieptImg");e.width=f.width,e.height=f.height;let g=f.height,j=f.width,k=e.getContext("2d");k.drawImage(f,0,0,j,g);let l=document.getElementById("smReceiptTemplate");k.globalAlpha=0.6;let m=l.height/l.width*j;k.drawImage(l,0,0,j,m),k.font="bold 60px Cordia New",k.textAlign="left",k.textBaseline="middle";let n={8:1*m/5,10:1.5*m/3,13:10*m/13},o=d.course;for(let q in o){let r=moment(o[q].day);k.fillText(o[q].courseName+" - "+o[q].tutorName,j/3,n[r.hour()])}k.globalAlpha=1,k.textAlign="center",k.font="bold 120px Cordia New",k.rotate(Math.PI/6);let p=Math.sqrt(Math.pow(j/2,2)+Math.pow(g/2,2));1===b?(k.fillStyle="red",k.fillText("REJECT",p,0)):2==b&&(k.fillStyle="green",k.fillText("FINISHED",p,0)),downloadCanvas(8)});return function(){return a.apply(this,arguments)}})(),showChatData=(()=>{var a=_asyncToGenerator(function*(){let c=yield $.post("post/v1/listChat",{studentID:ID,limit:3}),d=getCookieDict(),e=d.monkeyWebUser,f=c.chats;for(let g in $("#chatButt").empty(),f)f[g].sender._id===parseInt(e)?$("#chatButt").append("<row><p class='mb-0'><small><span class='fas fa-fw fa-user-secret'></span>&nbsp;me</small></p><button class='btn btn-primary col-10'>"+f[g].msg+"</button></row>"):$("#chatButt").append("<row><p class='mb-0 float-right'><small>"+f[g].sender.nicknameEn+"&nbsp;<span class='fas fa-fw fa-user'></span></small>&nbsp;</p><button class='btn btn-secondary col-10 offset-2'>"+f[g].msg+"</button></row>")});return function(){return a.apply(this,arguments)}})(),removeAllTimeTable=(()=>{var a=_asyncToGenerator(function*(){if(confirm("Are you sure to clear timetable?")){let b=[],c=[],d=[];if(0<$(".cr").length){for(let e=0;e<$(".cr").length;e++)b.push($(".cr")[e].id);yield removeStudentCourse(ID,b)}if(0<$(".hb").length){for(let e=0;e<$(".hb").length;e++)c.push(removeHybridStudent(ID,$(".hb")[e].id));yield Promise.all(c)}if(0<$(".sk").length){for(let e=0;e<$(".sk").length;e++)d.push(removeSkillStudent(ID,$(".sk")[e].id));yield Promise.all(d)}log("Finish to delete all data"),genStudentData()}});return function(){return a.apply(this,arguments)}})(),addTimeTable=(()=>{var a=_asyncToGenerator(function*(b){let c=$("#quarterSelect").val(),d=yield $.post("post/v1/listSubjectInQuarter",{year:c.slice(0,4),quarter:c.slice(5)});for(let e in $subjSelect=$("#subjSelect"),$subjSelect.empty(),d.hybrid){let f=moment(d.hybrid[e].day);0<=b.indexOf("btn"+f.day()+""+f.hour())&&($subjSelect.append("<option value="+d.hybrid[e].hybridID+">FHB:M</option>"),$subjSelect.append("<option value="+d.hybrid[e].hybridID+">FHB:P</option>"),$subjSelect.append("<option value="+d.hybrid[e].hybridID+">FHB:C</option>"),$subjSelect.append("<option value="+d.hybrid[e].hybridID+">FHB:E</option>"))}for(let e in d.course){let f=moment(d.course[e].day);0<=b.indexOf("btn"+f.day()+""+f.hour())&&$subjSelect.append("<option value="+d.course[e].courseID+">"+d.course[e].courseName+" - "+d.course[e].tutorName+"</option>")}for(let e in d.skill){let f=moment(d.skill[e].day),g=moment(d.skill[e].day);9==g.hour()&&g.hour(8),11==g.hour()&&g.hour(10),14==g.hour()&&g.hour(13),0<=b.indexOf("btn"+g.day()+""+g.hour())&&($subjSelect.append("<option value="+d.skill[e].skillID+">SKILL:M - "+f.format("HH:mm")+"</option>"),$subjSelect.append("<option value="+d.skill[e].skillID+">SKILL:E - "+f.format("HH:mm")+"</option>"),$subjSelect.append("<option value="+d.skill[e].skillID+">SKILL:ME - "+f.format("HH:mm")+"</option>"))}$("#addSubjModal").modal("show")});return function(){return a.apply(this,arguments)}})(),changeStudentInfo=(()=>{var a=_asyncToGenerator(function*(){let b={studentID:parseInt(ID)};""!=$("#nicknameInput").val()&&(b.nickname=$("#nicknameInput").val()),""!=$("#firstnameInput").val()&&(b.firstname=$("#firstnameInput").val()),""!=$("#lastnameInput").val()&&(b.lastname=$("#lastnameInput").val()),""!=$("#nicknameEInput").val()&&(b.nicknameEn=$("#nicknameEInput").val()),""!=$("#firstnameEInput").val()&&(b.firstnameEn=$("#firstnameEInput").val()),""!=$("#lastnameEInput").val()&&(b.lastnameEn=$("#lastnameEInput").val()),b.grade=parseInt($("#gradeInput").val()),""!=$("#levelInput").val()&&(b.level=$("#levelInput").val()),""!=$("#emailInput").val()&&(b.email=$("#emailInput").val()),""!=$("#phoneInput").val()&&(b.phone=$("#phoneInput").val()),""!=$("#parentPhoneInput").val()&&(b.phoneParent=$("#parentPhoneInput").val()),yield $.post("post/editStudent",b),log("Complete to change student info"),location.reload()});return function(){return a.apply(this,arguments)}})(),genCommentViewBody=(()=>{var a=_asyncToGenerator(function*(){$commentContentBody=$("#commentContentBody"),$commentContentBody.empty();let b=yield $.post("post/listStudentCommentByStudent",{studentID:ID});if(0==b.comment.length)$commentContentBody.append("<h5>No comment</h5>");else{let c=[];for(let e in b.comment)c.push(name(b.comment[e].tutorID));let d=yield Promise.all(c);for(let e in d)if($commentContentBody.append("<div id="+b.comment[e].commentID+"><h5><span class='fas fa-thumbtack' style="+(0<b.comment[e].priority?"color:red":"color:silver")+" onclick=\"editComment('1','"+b.comment[e].commentID+"','"+b.comment[e].priority+"');\"></span> <span class='fas fa-check-circle' style="+(b.comment[e].isCleared?"color:green":"color:silver")+" onclick=\"editComment('2','"+b.comment[e].commentID+"','"+b.comment[e].isCleared+"');\"></span> "+d[e].nickname+" ("+moment(b.comment[e].timestamp).format("DD MMM")+") <span class='fas fa-trash' style='color:red' onclick=\"editComment('3','"+b.comment[e].commentID+"','');\"></span></h5><p>"+b.comment[e].message+"</p></div>"),b.comment[e].hasAttachment){let f=yield getConfig(),g=f.studentCommentPicturePath.slice(f.receiptPath.search("MonkeyWebData")+14)+"/"+b.comment[e].commentID;$.get(g+".jpg").done(function(){$("#"+b.comment[e].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+g+".jpg'>")}).fail(function(){$.get(g+".png").done(function(){$("#"+b.comment[e].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+g+".png'>")}).fail(function(){$.get(g+".jpeg").done(function(){$("#"+b.comment[e].commentID).append("<img class='img-fluid col-12 col-md-6' src='"+g+".jpeg'>")}).fail(function(){log("can't find picture")})})})}}});return function(){return a.apply(this,arguments)}})(),showStudentAbsentHistory=(()=>{var a=_asyncToGenerator(function*(){let g,j,b=$("#quarterSelect").val(),c=$("#absentHistoryTableBody"),[d,e]=yield Promise.all([getConfig(),listQuarter("private")]),f=moment();for(let n in e.quarter)e.quarter[n].year===d.defaultQuarter.quarter.year&&e.quarter[n].quarter===d.defaultQuarter.quarter.quarter&&(log(e.quarter[n]),g=moment(parseInt(e.quarter[n].startDate)),j=moment(parseInt(e.quarter[n].endDate)));let[k,l,m]=yield Promise.all([$.post("post/v1/listAttendance",{studentStartDate:g.valueOf(),studentEndDate:j.valueOf(),studentID:ID}),$.post("post/v1/getStudentQuota",{studentID:ID,subj:"M"}),$.post("post/v1/getStudentQuota",{studentID:ID,subj:"P"})]);for(let n in c.empty(),k){let o=moment(k[n].date),p=moment(k[n].timestamp);c.append("<tr class='"+(1===k[n].type?"table-danger":"table-success")+"'><td class='text-center'>"+o.format("ddd DD/MM/YY HH:00")+"</td><td class='text-center'>"+(void 0===k[n].courseName?"FHB:"+(1===k[n].type?k[n].hybridSubject:k[n].subject):k[n].courseName)+"</td><td class='text-center'>"+(1===k[n].type?k[n].reason:"-")+"</td><td class='text-center'>"+p.format("ddd DD/MM/YY HH:mm")+"</td></tr>")}$("#absentHistoryMQuota").html(l.totalQuota-l.usedQuota+"/"+l.totalQuota),$("#absentHistoryPQuota").html(m.totalQuota-m.usedQuota+"/"+m.totalQuota),$("#viewAbsentModal").modal("show")});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var j=b[f](g),k=j.value}catch(l){return void d(l)}return j.done?void c(k):Promise.resolve(k).then(function(l){e("next",l)},function(l){e("throw",l)})}return e("next")})}}767<$(document).width()&&($("#statusSidebar").addClass("position-fixed"),$("#profileImg").css("max-height","50vh"),$("#recieptImg").css("max-height","80vh"));let cookie=getCookieDict(),ID=cookie.monkeyWebAdminAllstudentSelectedUser;loadProfileImg(),genQuarterSelect(),$("#quarterSelect").change(function(){writeCookie("monkeyWebSelectedQuarter",this.value),loadRecieptImg(),genStudentData()}),$(".selector").click(function(){"ADD SUBJ"===$(this).html()?addTimeTable(this.className):$(this).hasClass("cr")?removeCourse(this.id):$(this).hasClass("hb")?removeHybrid(this.id):$(this).hasClass("sk")&&removeSkill(this.id)}),$("#addSubjButt").click(function(){addStudentTimeTable()});let uploadImgType=0;$("#profileImg").click(function(){uploadImgType=0,$("#uploadPicModal").modal("show")}),$("#recieptImg").click(function(){uploadImgType=1,$("#uploadPicModal").modal("show")}),$("#uploadPicButt").click(function(){confirm("\u0E22\u0E37\u0E19\u0E22\u0E31\u0E19\u0E01\u0E32\u0E23 upload?")&&uploadImg(uploadImgType)}),$("#studentProfileContent").click(function(){$("#changeStudentInfoModal").modal("show")}),$("#changeStudentInfoButt").click(function(){changeStudentInfo()}),$("#commentViewButt").click(function(){genCommentViewBody(),$("#viewCommentModal").modal("show")}),$("#addChatBtn").click(function(){$("#addChatModal").modal("show")}),$("#addNewChatButt").click(function(){addNewChat()}),$("#mathCoverDowload").click(function(){$(this).hasClass("disabled")||genCover(0)}),$("#phyCoverDowload").click(function(){$(this).hasClass("disabled")||genCover(1)}),$("#cheCoverDowload").click(function(){$(this).hasClass("disabled")||genCover(2)}),$("#engCoverDowload").click(function(){$(this).hasClass("disabled")||genCover(3)}),$("#smMathCoverDowload").click(function(){genSummerCover(1)}),$("#smPhyCoverDowload").click(function(){genSummerCover(2)});function genChangeInfoModal(a){$("#nicknameInput").attr("placeholder",a.nickname),$("#firstnameInput").attr("placeholder",a.firstname),$("#lastnameInput").attr("placeholder",a.lastname),$("#nicknameEInput").attr("placeholder",a.nicknameEn),$("#firstnameEInput").attr("placeholder",a.firstnameEn),$("#lastnameEInput").attr("placeholder",a.lastnameEn),$("#gradeInput").val(a.grade),$("#levelInput").attr("placeholder",a.level),$("#emailInput").attr("placeholder",a.email),$("#phoneInput").attr("placeholder",a.phone),$("#parentPhoneInput").attr("placeholder",a.phoneParent)}const dayIndex=a=>{switch(moment(a).day()){case 2:return 0;case 4:return 1;case 6:return 2;case 0:return 3;}},hourIndex=a=>{switch(moment(a).hour()){case 8:case 9:return 0;case 10:case 11:return 1;case 13:case 14:return 2;case 15:case 16:return 3;case 17:return 4;}};function downloadCanvas(a){let b="",c;switch(a){case 0:c=document.getElementById("mathCover"),b+=ID+"1.png";break;case 1:c=document.getElementById("phyCover"),b+=ID+"2.png";break;case 2:c=document.getElementById("cheCover"),b+=ID+"3.png";break;case 3:c=document.getElementById("engCover"),b+=ID+"4.png";break;case 6:c=document.getElementById("smCover"),b+=ID+"1sm.png";break;case 7:c=document.getElementById("smCover"),b+=ID+"2sm.png";break;default:}let d=c.toDataURL(),e=document.createElement("a");e.href=d,e.download=b,document.body.appendChild(e),e.click()}function changeStudentStatus(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1B\u0E25\u0E35\u0E48\u0E22\u0E19 status?")&&$.post("post/changeStatus",{userID:ID,status:a}).then(()=>{log("OK:Change student status complete"),genStatusPanel(a)})}function changeStudentState(a){let b=$("#quarterSelect").val();confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1B\u0E25\u0E35\u0E48\u0E22\u0E19 state?")&&("rejected"==a?genCover(4):"finished"==a&&genCover(5),"UNREGISTER"==$($("#statusSubButton .btn-success")).html()?changeRegistrationState(ID,a,{year:b.slice(0,4),quarter:b.slice(5)}).then(()=>{log("OK:Change student state complete"),genStatusPanel("active")}):$.post("post/v1/updateStudentRegistrationState",{studentID:ID,year:b.slice(0,4),quarter:b.slice(5),registrationState:a,subRegistrationState:"-"}).then(()=>{log("OK:Change student state complete"),genStatusPanel("active")}))}function addNewChat(){let a={};0<$("#chatMsg").val().length?(a.msg=$("#chatMsg").val(),a.studentID=ID,$.post("post/v1/addChat",a).then(b=>{log(b),showChatData(),$("#chatMsg").val(""),$("#addChatModal").modal("hide")})):alert("Please input some text.")}function removeCourse(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A\u0E04\u0E2D\u0E23\u0E4C\u0E2A\u0E19\u0E35\u0E49?")&&removeStudentCourse(ID,[a]).then(()=>{log("finish to remove cr "+a),location.reload()})}function removeHybrid(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A FHB \u0E19\u0E35\u0E49?")&&removeHybridStudent(ID,a).then(()=>{log("finish to remove fhb "+a),location.reload()})}function removeSkill(a){confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A skill \u0E19\u0E35\u0E49?")&&(log("rm sk"+a),removeSkillStudent(ID,a).then(()=>{log("finish to remove skill "+a),location.reload()}))}function addStudentTimeTable(){let a=$("#subjSelect").val(),b=$("#subjSelect option:selected").text();"FHB"===b.slice(0,3)?confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+b)&&addHybridStudent(a,ID,b.slice(4)).then(()=>{log("finish to add "+b),location.reload()}):"SKI"===b.slice(0,3)?confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+b)&&addSkillStudent(a,ID,b.slice(6,b.indexOf("-")-1)).then(()=>{log("finish to add "+b),location.reload()}):confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E40\u0E1E\u0E34\u0E48\u0E21 "+b)&&addStudentCourse(ID,[a]).then(()=>{log("finish to add CR:"+b),location.reload()})}function uploadImg(a){let b=$("#quarterSelect").val(),c="",d=$("#file-img"),e=d.val().split(".").pop().toLowerCase();if(-1===$.inArray(e,["png","jpg","jpeg"]))alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E2D\u0E31\u0E1E\u0E44\u0E1F\u0E25\u0E4C .jpg, .jpeg \u0E2B\u0E23\u0E37\u0E2D .png \u0E40\u0E17\u0E48\u0E32\u0E19\u0E31\u0E49\u0E19");else{let f=d.get(0).files,g=new FormData,j=f[0];g.append("file[]",j,j.name),0==a?(c="post/updateProfilePicture",g.append("userID",ID)):1==a&&(c="post/submitReceipt",g.append("studentID",ID),g.append("year",b.slice(0,4)),g.append("quarter",b.slice(5))),$.ajax({url:c,type:"POST",data:g,processData:!1,contentType:!1,success:function(){location.reload()}})}}function editComment(a,b,c){switch(a){case"1":$.post("post/changeStudentCommentPriority",{commentID:b,priority:0<c?0:1});break;case"2":$.post("post/clearStudentComment",{commentID:b,isCleared:"true"!=c});break;case"3":confirm("\u0E15\u0E49\u0E2D\u0E07\u0E01\u0E32\u0E23\u0E25\u0E1A comment \u0E19\u0E35\u0E49?")&&$.post("post/removeStudentComment",{commentID:b});break;default:}genCommentViewBody()}$("#absentViewButt").click(function(){showStudentAbsentHistory()});