let loadProfileImg=(()=>{var a=_asyncToGenerator(function*(){let b=yield getConfig(),c=b.profilePicturePath.slice(b.profilePicturePath.search("MonkeyWebData")+14)+ID;$.get(c+".jpg").done(function(){$("#profileImg").attr("src",c+".jpg")}).fail(function(){$.get(c+".png").done(function(){$("#profileImg").attr("src",c+".png")}).fail(function(){$.get(c+".jpeg").done(function(){$("#profileImg").attr("src",c+".jpeg")}).fail(function(){log("can't find picture")})})})});return function(){return a.apply(this,arguments)}})(),genQuarterSelect=(()=>{var a=_asyncToGenerator(function*(){let[b,c]=yield Promise.all([listQuarter("public"),getConfig()]),d=$("#quarterSelect");for(let f in b.quarter)d.append("<option value='"+b.quarter[f].quarterID+"'>"+b.quarter[f].name+"</option>");year=c.defaultQuarter.registration.year,quarter=c.defaultQuarter.registration.quarter,d.val(year+(10<=quarter?"":"0")+quarter),genStudentData(),genStudentTimeTable()});return function(){return a.apply(this,arguments)}})(),genStudentData=(()=>{var a=_asyncToGenerator(function*(){$("#studentProfileContent").empty();let b=yield studentProfile(ID),c=$("#quarterSelect").val(),d="\u0E22\u0E31\u0E07\u0E44\u0E21\u0E48\u0E44\u0E14\u0E49\u0E25\u0E07\u0E17\u0E30\u0E40\u0E1A\u0E35\u0E22\u0E19";for(let f in b.quarter)b.quarter[f].year==c.slice(0,4)&&b.quarter[f].quarter==c.slice(4)&&(d=b.quarter[f].registrationState);768<=$(document).width()?$("#studentProfileContent").append("<h4>"+b.firstname+" ("+b.nickname+") "+b.lastname+"</h4><h4>"+b.firstnameEn+" ("+b.nicknameEn+") "+b.lastnameEn+"</h4><h4>ID: "+ID+"</h4><h4>\u0E0A\u0E31\u0E49\u0E19: "+(6<b.grade?"\u0E21."+(b.grade-6):"\u0E1B."+b.grade)+"</h4><h4><span class='fa fa-phone'></span> "+b.phone+"</h4><h4><span class='fa fa-envelope'></span> "+b.email+"</h4><h4>\u0E2A\u0E16\u0E32\u0E19\u0E30: "+d+"</h4>"):$("#studentProfileContent").append("<h6>"+b.firstname+" ("+b.nickname+") "+b.lastname+"</h6><h6>"+b.firstnameEn+" ("+b.nicknameEn+") "+b.lastnameEn+"</h6><h6>ID: "+ID+"</h6><h6>\u0E0A\u0E31\u0E49\u0E19: "+(6<b.grade?"\u0E21."+(b.grade-6):"\u0E1B."+b.grade)+"</h6><h6><span class='fa fa-phone'></span> "+b.phone+"</h6><h6><span class='fa fa-envelope'></span> "+b.email+"</h6><h6>\u0E2A\u0E16\u0E32\u0E19\u0E30: "+d+"</h6>")});return function(){return a.apply(this,arguments)}})(),genStudentTimeTable=(()=>{var a=_asyncToGenerator(function*(){let b=$("#quarterSelect").val();10<=parseInt(b.slice(4))?($("#mainTable").collapse("hide"),$("#summerTable").collapse("show")):($("#summerTable").collapse("hide"),$("#mainTable").collapse("show")),$(".selector").html("&nbsp;").removeClass("cr hb sk");let c=yield $.post("post/v1/studentTimeTable",{studentID:ID,year:b.slice(0,4),quarter:b.slice(4)});for(let d in c.course){let f=moment(c.course[d].day);$(".btn"+f.day()+"-"+f.hour()).addClass("cr").html(c.course[d].courseName+" - "+c.course[d].tutorName)}for(let d in c.hybrid){let f=moment(c.hybrid[d].day);$(".btn"+f.day()+"-"+f.hour()).addClass("hb").html("FHB:"+c.hybrid[d].subject)}for(let d in c.skill){let f=moment(c.skill[d].day);switch(f.hour()){case 8:case 9:$(".btn"+f.day()+"-8").addClass("sk").html("SK:"+c.skill[d].subject+" - "+f.format("HH:mm"));break;case 10:case 11:$(".btn"+f.day()+"-10").addClass("sk").html("SK:"+c.skill[d].subject+" - "+f.format("HH:mm"));break;case 13:case 14:$(".btn"+f.day()+"-13").addClass("sk").html("SK:"+c.skill[d].subject+" - "+f.format("HH:mm"));break;case 15:case 16:$(".btn"+f.day()+"-15").addClass("sk").html("SK:"+c.skill[d].subject+" - "+f.format("HH:mm"));break;default:$(".btn"+f.day()+"-"+f.hour()).addClass("sk").html("SK:"+c.skill[d].subject+" - "+f.format("HH:mm"));}}});return function(){return a.apply(this,arguments)}})();function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function f(g,h){try{var j=b[g](h),k=j.value}catch(l){return void d(l)}return j.done?void c(k):Promise.resolve(k).then(function(l){f("next",l)},function(l){f("throw",l)})}return f("next")})}}let cookie=getCookieDict(),ID=cookie.monkeyWebUser,year,quarter;loadProfileImg(),genQuarterSelect(),$("#quarterSelect").change(function(){genStudentData(),genStudentTimeTable()}),$("#profileImg").click(function(){window.File&&window.FileReader&&window.FileList&&window.Blob?$("#uploadPicModal").modal("show"):alert("\u0E01\u0E23\u0E38\u0E13\u0E32\u0E40\u0E1B\u0E25\u0E35\u0E48\u0E22\u0E19 Browser")});let options={thumbBox:".thumbBox",spinner:".spinner",imgSrc:"#"},cropper=$(".imageBox").cropbox(options);$("#uploadPic").on("change",function(){let a=new FileReader;a.onload=function(b){options.imgSrc=b.target.result,cropper=$(".imageBox").cropbox(options)},a.readAsDataURL(this.files[0])}),$("#btnZoomIn").on("click",function(){cropper.zoomIn()}),$("#btnZoomOut").on("click",function(){cropper.zoomOut()});function dataURItoBlob(a){let b=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):unescape(a.split(",")[1]);let c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length);for(let f=0;f<b.length;f++)d[f]=b.charCodeAt(f);return new Blob([d],{type:c})}function uploadImg(a){let c=dataURItoBlob(a),d=new FormData;d.append("file[]",c,"file.png"),imgUrl="post/updateProfilePicture",d.append("userID",ID),$.ajax({url:imgUrl,type:"POST",data:d,processData:!1,contentType:!1,success:function(){location.reload()}})}